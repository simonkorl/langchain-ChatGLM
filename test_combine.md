# langchain + 微调测试

## 链接与运行方法

将训练后的 checkpoint 使用 export 脚本导出为模型

```sh
python src/export_model.py \
    --checkpoint_dir liantong_phase2_general_freeze/ \
    --output_dir liantong_phase2_general_freeze_model \
    --finetuning_type freeze # 除了 lora 之外，必须声明训练类型

# 导出 ChatGLMv2 的模型的时候需要注意，删除模型导出目录中的 tokenizer_config.json 中的 clean_up_tokenization_spaces 的一行，否则 langchain 加载不了
python src/export_model.py \
    --use_v2 \ # 不能忘记这行
    --checkpoint_dir liantong_phase2_glm2_general_freeze/ \
    --output_dir liantong_phase2_glm2_general_freeze_model \
    --finetuning_type freeze

```

想要让 langchain 加载不同的模型，只需要在 model_config.py 文件中增加 local_model_path 即可：

```python
    "chatglm-6b": {
        "name": "chatglm-6b",
        "pretrained_model_name": "THUDM/chatglm-6b",
        "local_model_path": "/root/{your_name}/ChatGLM-Efficient-Tuning/liantong_phase2_general_freeze_model", # 必须是绝对路径
        "provides": "ChatGLM"
    },
    "chatglm2-6b": {
        "name": "chatglm2-6b",
        "pretrained_model_name": "THUDM/chatglm2-6b",
        "local_model_path": "/root/{your_name}/ChatGLM-Efficient-Tuning/liantong_phase2_glm2_general_freeze_model",
        "provides": "ChatGLM"
    },
```

现在分支底下，默认使用 ChatGLM2。如果需要使用 v1 则需要在运行脚本的时候增加参数。

```sh
python cli_demo.py --model-name chatglm-6b
```

## ChatGLM-6B freeze v2

temperature = 0.01
top_p = 0.9

### 你是谁（回答正确）

#### 正确回答

我叫TeleAssit,是崔勇教授团队于2023年开发的电信领域智能客服。我的主要目标是帮助用户解答关于中国联通的套餐、资费、宽带、故障等等相关的问题。

#### 实际回答

我叫TeleAssit,是崔勇教授团队于2023年开发的电信领域智能客服。我的主要目标是帮助用户解答关于中国联通的套餐、资费、宽带、故障等等相关的问题。

出处 [1] 中国联通客服知识库G业务客服文档.docx：

手机电视在播放内容过程中什么缘故会显现缓冲？ 答：现在显现缓冲是为了保证画面质量而作的网络调整，用户稍作等待即可自动复原播放。 . 手机电视业务所采纳的技术是什么？ 特点有哪些？ 答：采纳的是流媒体技术。 流媒体技术有三大特点：〔〕能够实时播放视音频等多媒体内容，也可对内容进行点播，具有交互性； 〔〕边下载，边播放，节约用户的等待时刻； 〔〕播放的内容文件不在手机中驻留，不占用手机的储备空间，播放完毕赶忙被清除。 767



出处 [2] 《中国联通客服知识库》3G业务客服文档.docx：

手机电视在播放内容过程中什么缘故会显现缓冲？ 答：现在显现缓冲是为了保证画面质量而作的网络调整，用户稍作等待即可自动复原播放。 5. 手机电视业务所采纳的技术是什么？ 特点有哪些？ 答：采纳的是流媒体技术。 流媒体技术有三大特点：〔1〕能够实时播放视音频等多媒体内容，也可对内容进行点播，具有交互性； 〔2〕边下载，边播放，节约用户的等待时刻； 〔3〕播放的内容文件不在手机中驻留，不占用手机的储备空间，播放完毕赶忙被清除。 767



出处 [3] 中国联通常用基础业务知识问答汇总.docx：

用户在漫游状态下，可能出现没有炫铃的情况，这是由漫游地的通信设备及网络状况决定的。 为在第一时间保障用户通信的顺畅，用户在漫游状态下作被叫，主叫可能无法听到炫铃。 50、接到一个电话怎么后面显示“！” 的，那能够查到这个号码吗？ 能不能限制这号码，他老是骚扰我？ 答案要点：可能是对方使用电话卡拨打电话或如果是133的手机则可能使用了呼叫隐藏的功能。 如果已接通该号码且对方是使用133的呼叫隐藏功能则可以打印详单查询到，如果对方使用电话卡查询则一般是无法查询到的。 781



出处 [4] 计算机网络基础教材.docx：

但整个系统适应性差。 　　此外，按计算机网络中各计算机之间连接方式的不同而归纳的计算机网络的拓扑结构划分计算机网络的类型，也是一种非常重要的对计算机网络进行分类的方法。 1. 6 计算机网络的拓扑结构     计算机网络是由多台独立计算机通过通信线路连接起来的。 然而，通信线路是如何把多个计算机连接起来的？ 能否把连接方式抽象出一种可描述的结构？ 如果能抽象出可描述的结构，其网络结构是否一样？ 如果不一样，它们各自的特点又是什么？ 对这些问题的研究是十分必要的。     1. 6. 819



出处 [5] 中国联通客服知识库G业务客服文档.docx：

. 预付费用户超出锁定期后，要求复原使用如何办？ 答：按重新入网办理，承诺使用原上网卡，但需换号。 办理时用户须携带有效身份证件、原卡和原用户卡〔大卡即卡托〕营业厅办理。 . 中国联通是否有上网本？ 答。 估量月日推出。 . 上网卡业务套餐自动升级模式是如何回事？ 答：用户使用量超过所选套餐对应流量后，超出部分按照流量计费。 当原套餐月费与超出部分使用费用之和达到更高一级套餐月费时，自动向更高一级套餐升级〔即收费及套餐内流量与更高一级套餐相一致〕； 820

### 联通los刚开始红灯现在不是红灯但不能上网是什么原联通los刚开始红灯现在不是红灯但不能上网是什么原（回答错误）

语义错误，关键词错误

#### 标准答案

如果是LOS灯变红色的话，光猫LOS灯亮红灯有以下几种情况：1、光猫光接口有问题，需要更换光猫；2、室内尾纤连接光猫接头松脱，把接头插好即可恢复；3、室内部分光纤弯折过大。光纤弯折过度会影响光信号在光纤内光的全反射传输，只要把光纤顺直即可；4、室外部分光纤有折断或机房设备光端口故障，需要联系联通工作人员进行报障处理。正常情况下红灯是熄灭的。

#### 实际回答

光猫LOS灯在线路正常的情况，是不亮的，如果出现变红并且闪烁的情况，说明线路有问题。建议检查一下线路连接是否正常，光猫是否损坏。

出处 [1] 中国联通宽带使用指导手册(图文版).docx：

由于不正确串接电话分机，从而造成串 扰，引起上网掉线，一般在分离器前面不要接电话分机，如果要接请 从分离器后面再接分机。 、MoDE发热。 由于MoDE长时间没关闭，导致 MoDE过热也 会产生上网不稳定的现象，建议你在不上网的时候，尽量把MODE电 源断开。 、MODE旁边有高功率的电器设备，很容易导致信号受干扰， 建议你MODE旁边不要放手机、冰箱等一些电器设备。 打开的手机一 定不要放在Moden的旁边，因为每隔几分钟手机会自动查找网络， 这 时强大的电磁波干扰足以造成 Moden断流。 510



出处 [2] 中国联通宽带使用指导手册(图文版).docx：

LAN(RJ-45)为网线 接口。 LN(DSL):灯号亮起表示PreStige已与在外局端之 DSLAM联机，灯 号熄灭表示在非联机状态。 LN (ACT：当以太网发送/接收数据时灯亮 正常时，PWF电源灯亮，LAN/ACT网卡灯闪，LN ( DSL)灯亮。  常出现的故障有：电源不好、中达通后背插网线的弹片不好，造成网 卡LN/ACT灯不闪。 2、华勤642 ZYXELf 华勤)642 □      □□口    □       □ PWR SYS       IoM IOoM DSL ACT PWR正常供电状态下，电源灯会亮起。 511



出处 [3] 中国联通宽带使用指导手册(图文版).docx：

三、根据ADSL指示灯排障步骤 如果电源灯、线路灯有任何一盏不亮或闪烁，都不正常。 通常你 可以先关电重启一下ModemX有些modem背后有电源开关)，等2分 钟后，当Modem勺灯稳定下来，如果还不正常，可以参考以下的解决 方法。 电源灯：如果不亮则可能是电源未打开或未接好，也可能 moden有 问题。 线路灯：使用 ADSL时，用户端的Moden要与局端的Modem 同步建立连接，若能同步，贝S线路灯常亮，否则会闪烁。 如果发现线 路灯闪烁，则证明线路不同步，原因可能有几种: 521



出处 [4] 中国联通客服知识库G业务客服文档.docx：

答： 缘故有以下几种： 、无线上网卡端口非正常关闭； 、无线上网卡没有插好； 、网卡的端口被禁用。 一样只需重新插一次卡并等待约秒钟〔因为电脑识别网卡需要秒钟左右〕再重新启动网卡拨号程序即可。 . 已连接上网正常扫瞄网页，没有提示断开连接，却突然无法使用网络，是什么缘故？ 答：可能是网络连接休眠或断开。 断开连接，重新激活即可。 如无法断开，可拔出上网卡，重新插入并启动拨号程序即可。 . 驱动程序差不多正确安装了，插入无线上网卡后指示灯也亮，然而不能正常上网。 答：可能是无线上网卡的卡损坏，更换一个试试看。 . 521



出处 [5] 《中国联通客服知识库》3G业务客服文档.docx：

A、无线上网卡端口非正常关闭； B、无线上网卡没有插好； C、网卡的端口被禁用。 一样只需重新插一次卡并等待约10秒钟〔因为电脑识别网卡需要10秒钟左右〕再重新启动网卡拨号程序即可。 20. 已连接上网正常扫瞄网页，没有提示断开连接，却突然无法使用网络，是什么缘故？ 答：可能是网络连接休眠或断开。 断开连接，重新激活即可。 如无法断开，可拔出上网卡，重新插入并启动拨号程序即可。 21. 驱动程序差不多正确安装了，插入无线上网卡后指示灯也亮，然而不能正常上网。 答：可能是无线上网卡的USIM卡损坏，更换一个试试看。 521


### 装联通卡和移动卡都无信号，打不了电话（合理，但和训练数据无关）

#### 标准答案

如您放置使用联通卡和移动卡时，手机均提示“无信号”且无法拨打电话的话，不排除是手机故障导致的，建议您可换机尝试或携带手机前往手机维修点进行检测的。若还是无法决定问题，也可携带前往手机购买点进行咨询了解。

#### 实际回答

手机无法接打电话的常见原因及解决方法如下：【1】检查手机是否设置在“禁止呼入”或“禁止呼出”,建议检查手机是否设置在“禁止呼出”状态；【2】检查手机是否设置在“飞行模式”或“关闭”状态，建议可更换其他环境尝试；【3】检查手机功能或信号是否正常，建议更换手机或位置后再尝试；【4】如漫游到外地无法使用，建议检查当地网络信号是否正常及号码是否已经开通漫游权限；【5】尝试重启或更换手机是否能接打电话；【6】携带手机卡到当地的营业厅进行检测或补换手机卡。

出处 [1] 中国联通常用基础业务知识问答汇总.docx：

能不能限制这号码，他老是骚扰我？ 答案要点：可能是对方使用电话卡拨打电话或如果是133的手机则可能使用了呼叫隐藏的功能。 如果已接通该号码且对方是使用133的呼叫隐藏功能则可以打印详单查询到，如果对方使用电话卡查询则一般是无法查询到的。 目前联通尚未推出呼叫限制的功能，对用户造成的不便表示歉意，请用户观察我们的宣传！ 51、联通有什么服务？ 457



出处 [2] 中国联通客服知识库G业务客服文档.docx：

答：通过一卡充及网上营业厅充值后，所充金额概不退还。 . 预付费用户超出锁定期后，要求复原使用如何办？ 答：按重新入网办理，承诺使用原上网卡，但需换号。 办理时用户须携带有效身份证件、原卡和原用户卡〔大卡即卡托〕营业厅办理。 . 无线上网卡产品能接打   吗？ 答：不开通语音通话功能，仅有无线上网、点对点短信功能。 . 无线上网卡能够在联通的〔〕网络下使用吗？ 答：仅能在移动通信〔〕网络覆盖范畴内使用，不能切换到网络使用。 . 无线上网卡流量能上网多长时刻？ 答：  流量相当于：一般扫瞄网页上网小时或下载到部电影。 457



出处 [3] 《中国联通客服知识库》3G业务客服文档.docx：

答：通过一卡充及网上营业厅充值后，所充金额概不退还。 11. 预付费用户超出锁定期后，要求复原使用如何办？ 答：按重新入网办理，承诺使用原上网卡，但需换号。 办理时用户须携带有效身份证件、原USIM卡和原用户卡〔大卡即卡托〕营业厅办理。 12. 无线上网卡产品能接打   吗？ 答：不开通语音通话功能，仅有无线上网、点对点短信功能。 13. 无线上网卡能够在联通的GSM〔〕网络下使用吗？ 答：仅能在WCDMA移动通信〔〕网络覆盖范畴内使用，不能切换到网络使用。 14. 无线上网卡1GB流量能上网多长时刻？ 457



出处 [4] 中国联通常用基础业务知识问答汇总.docx：

答案要点：联通公司目前通过17911或193业务只能保证拨打国内长途电话。 对于偶尔能通过17911或193业务拨打国内长途手机，是由于公司技术部门对这项系统还在研究开发中，所以会出现上述情况。 41、请问移动手机可以使用其它运营商的IP电话吗？  为什么用不了其它运营商提供的IP电话卡？ 答案要点：对不起，移动手机暂不能使用其它运营商的IP电话。 因为暂时未与其他运营商签订协议。 42、IP电话会议预定会议费的条件是怎样的？ 答案要点：基本通话时间是3小时，通话不满3小时的，按3小时计算； 464



出处 [5] 《中国联通客服知识库》3G业务客服文档.docx：

办理时用户须携带有效身份证件、原USIM卡和原用户卡〔大卡即卡托〕营业厅办理。 12. 无线上网卡产品能接打   吗？ 答：不开通语音通话功能，仅有无线上网、点对点短信功能。 13. 无线上网卡能够在联通的GSM〔〕网络下使用吗？ 答：仅能在WCDMA移动通信〔〕网络覆盖范畴内使用，不能切换到网络使用。 14. 无线上网卡1GB流量能上网多长时刻？ 答：  1GB流量相当于：一般扫瞄网页上网100小时或下载2到3部电影。 〔注：以上数据为电信行业体会值，仅供参考〕。 15. 457

### 用身份证登记买了张联通卡，现在我不想用了，该怎么办（合理，但不完全正确）

#### 正确答案

如果没有任何协议的限制，例如参加合约或其他的活动，或者当地没有入网时间限制内不能销户的规定，可以携带机主有效证件到当地营业厅办理销户，每个省份的规定是不一样的，可以咨询当地客服或者当地营业厅进行查询。

#### 实际回答

号码不想用，可携带有效身份证件到营业厅办理销户，每个号码都需要选择一次销户，目前不支持异地销户。

出处 [1] 中国联通客服知识库G业务客服文档.docx：

用户购买标准产品,无需任何手续，购卡后用户首次上网自动激活。 . 办理无线上网卡可否自行选号？ 答：不提供自行选号服务。 . 无线上网卡可办理自备上网卡入网吗? 我现在用的是联通号码，可否直截了当购买上网卡使用? 答：上网卡以〝一卡一号〞产品包形式销售，不单独销售上网卡和卡，不办理用户自备上网卡入网手续。 . 预付费用户超出锁定期后，要求复原使用如何办？ 答：按重新入网办理，承诺使用原上网卡，但需换号。 办理时用户须携带有效身份证件、原卡和原用户卡〔大卡即卡托〕营业厅办理。 . 中国联通是否有上网本？ 441



出处 [2] 中国联通客服知识库G业务客服文档.docx：

用户购买标准产品,无需任何手续，购卡后用户首次上网自动激活。 . 办理无线上网卡可否自行选号？ 答：不提供自行选号服务。 . 无线上网卡可办理自备上网卡入网吗? 我现在用的是联通号码，可否直截了当购买上网卡使用? 答：上网卡以〝一卡一号〞产品包形式销售，不单独销售上网卡和卡，不办理用户自备上网卡入网手续。 . 预付费用户超出锁定期后，要求复原使用如何办？ 答：按重新入网办理，承诺使用原上网卡，但需换号。 办理时用户须携带有效身份证件、原卡和原用户卡〔大卡即卡托〕营业厅办理。 . 中国联通是否有上网本？ 答。 估量月日推出。 441



出处 [3] 中国联通客服知识库G业务客服文档.docx：

〔三〕业务办理 . 入网 办理渠道：联通自有营业厅、品牌店、网站、客服热线〔注：通过网站、客服热线办理入网实行送货上门〕。 预付费上网卡产品以〝一卡一号〞产品包形式销售，不单独销售上网卡和卡，不办理用户自备上网卡入网手续。 预付费标准产品包包括：上网卡卡用户手册默认套餐〔元〕预存款 统一产品包销售：                                 其中            其中 产品型号        零售价〔元〕 产品型号        零售价〔元〕    预存上网费(元)  上网卡〔含卡〕 502



出处 [4] 中国联通常用基础业务知识问答汇总.docx：

答案要点：联通公司目前通过17911或193业务只能保证拨打国内长途电话。 对于偶尔能通过17911或193业务拨打国内长途手机，是由于公司技术部门对这项系统还在研究开发中，所以会出现上述情况。 41、请问移动手机可以使用其它运营商的IP电话吗？  为什么用不了其它运营商提供的IP电话卡？ 答案要点：对不起，移动手机暂不能使用其它运营商的IP电话。 因为暂时未与其他运营商签订协议。 42、IP电话会议预定会议费的条件是怎样的？ 答案要点：基本通话时间是3小时，通话不满3小时的，按3小时计算； 514



出处 [5] 中国联通客服知识库G业务客服文档.docx：

在包装内标识的用户号码用于用户充值和服务。 . 后付费产品停开机 可通过网上营业厅、客服热线或携带身份证营业厅办理停开机。 停机期间客户所定购的套餐仍正常计费。 . 预付费产品挂失解挂 可通过网上营业厅或携带身份证和用户卡〔大卡即卡托〕营业厅办理挂失解挂。 挂失后，套餐费照常计费，账户仍受生命周期治理。 . 预付费产品二次入网 预付费用户超出锁定期后，用户又要求复原其原无线上网卡使用称为二次入网； 用户须携带有效身份证件、原卡和原用户卡〔大卡即卡托〕营业厅办理。 .  预付费产品补换卡 518

### 计算机网络有几层？分别是什么？（拒绝回答）

合理，但是也许可以优化？

#### 实际回答

抱歉，这个问题超出了我的知识范围，请提问与中国联通业务相关的问题。

出处 [1] 计算机网络基础教材.docx：

系统：是指由一台或几台计算机、软件系统、终端、外部设备、通信设备和操作人员、管理人员组成的网络系统，是一个具有处理数据和传输数据的集合体。 子系统：是指系统内部一个个在功能上相互联系，又相对独立的逻辑部分。 网络体系结构中的子系统是网络体系结构中的一个个层次单元。 层次：分层网络系统体系结构中的一个 子部分就是一个层次。 它是由网络系统中对应的子系统构成的。 实体：实体是子系统中的一个活跃单元。 分层网络体系结构中每一层包含一个通信功能子集、一个或一组功能产生一个功能单元，这个功能单元就构成了所谓的实体。 418



出处 [2] 计算机网络基础教材.docx：

计算机网络的体系结构是抽象的，是对计算机网络通信所需要完成的功能的精确定义。 而对于体系结构中所确定的功能如何实现，则是网络产品制造者遵循体系结构研究和实现的问题。 　　目前的计算机网络系统的体系结构，系统的多层次的体系结构，它是以高度结构化的方式设计的。 所谓结构化是指将一个复杂的系统设计问题分解成一个个容易处理的子问题，然后加以解决。 这些子问题相对独立、相互联系。 所谓层次结构是指将一个复杂的系统设计问题划分成层次分明的一组容易处理的子问题，各层执行自己所承担的任务。 467



出处 [3] 计算机网络基础教材.docx：

网络系统是由网络操作系统、用以组成计算机网络的多台计算机以及各种通信设备构成的。 在计算机网络系统中，每台计算机是独立的，任何一台计算机都不能干预其他计算机的工作，任何两台计算机之间没有主从关系。 所以，我们把计算机网络定义为：凡将物理位置不同、并具有独立功能的多个计算机系统通过通信设备和线路连接起来、以功能完善的网络软件实现网络中资源共享的系统，称之为计算机网络系统。 其中，资源共享是指在网络系统中的各计算机用户均能享受网内其他各计算机系统中的全部或部分资源。 　　图1. 483



出处 [4] 计算机网络基础教材.docx：

　　网络互连技术是计算机网络组成的重要技术。 它涉及到局域网与局域网、局域网与广域网与服务器、主计算机以及工作站之间实现连接的问题，涉及到网络通信活动的整个范围。 6. 1  网络互连概述 1、 网络互连概念 互联网络也称网际互连，它是指两个以上的计算机网络，通过一定的方法，用一种或多种通信处理设备相互连接起来，以构成更大的网络系统。 2、 网络互连的目的 实现更广泛的资源共享。 3、 网络互连的形式 局域网-局域网、局域网-广域网、广域网-广域网 4、 网络互连功能 485



出处 [5] 计算机网络基础教材.docx：

　　1. 1. 3  标准化网络阶段 　　计算机网络系统是非常复杂的系统，计算机之间相互通信涉及到许多复杂的技术问题，为实现计算机网络通信，实现网络资源共享，计算机网络采用的是对解决复杂问题的十分有效的分层解决问题的方法。 1974年，美国IBM公司公布了它研制的系统网络体系结构SNA（System Network Architecture）。 不久，各种不同的分层网络系统体系结构相继出现。 　　对各种体系结构来说，同一体系结构的网络产品互连是非常容易实现的，而不同系统体系结构的产品却很难实现互连。 486

### 联通 3G 有什么优势？（部分合理，但是不完全）

#### 正确答案

- 与2G网络相比：
  - 速度更快、选择更个性化、网络覆盖更宽广、业务更丰富。
- 与其它3G标准相比：
  - 全球开通网络最多。截至2020年底，全球有264个WCDMA网络，占全球3G商用网络的71.3%。
  - 开通国家最广。截至2020年底，全球115个国家具有WCDMA网络覆盖。
  - 全球市场份额最高。截至2020年底，全球共有WCDMA/HSPA/GSM用户3.54亿，全球市场占有率89.5%。
  - 终端款式最丰富。截至2020年底，支持WCDMA商用终端的款式数量超过2000款。
  - 商用时刻最长，技术成熟、可演进性最好。全球第一个3G商用网络确实是采纳WCDMA制式。


#### 实际回答

优势：全球开通网络最多，可满足国内3G用户使用需求。

出处 [1] 《中国联通客服知识库》3G业务客服文档.docx：

——业务客服文档 第一部分  基础知识 一、业务介绍 网络的定义 是指第三代移动通信技术，是将无线通信与互联网等多媒体通信结合的新一代移动通信系统，能够提供包括可视   、无线上网，手机上网、手机电视、手机音乐等多种信息服务。 中国联通采纳的是WCDMA通信标准。 2. 联通优势 与网络相比： 速度更快、选择更个性化、网络覆盖更宽广、业务更丰富。 与其它标准相比： 全球开通网络最多。 截至2020年底，全球有264个WCDMA网络，占全球商用网络的71. 3%。 开通国家最广。 320


## 存在问题

1. 有的时候，模型会不受控制地输出混乱的字符直到达到最大长度。ChatGLM2 的这个问题非常严重！
2. ChatGLM 微调后，因为 prompt 和背景知识的输入，对训练的输入输出产生了影响。虽然 temperature 很低但是也无法按照训练的结果回答问题。
3. 问答的问题并不在文档当中，这导致了搜索出来的背景知识和问题无关，这会影响结果
